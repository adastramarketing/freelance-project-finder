========================================
Документація: index.cjs (Етап 1)
========================================

Коротко
------

Скрипт `index.cjs`:

1) тягне проєкти з Freelancehunt API;
2) префільтрує їх по статусу, бюджету та ключових словах;
3) віддає релевантні проєкти в OpenAI-модель для оцінки (fit/score/category/reason);
4) підсилює проєкти, повʼязані з Merchant Center / Shopping / PMax;
5) трохи знижує пріоритет менеджерських ролей (але не відкидає їх);
6) сортує всі проєкти за пріоритетом;
7) зберігає:
   - повний результат у `results-*.json`,
   - окремо рекомендовані (fit=true) у `results-recommended-*.json`;
8) веде історію переглянутих проєктів у `seen-projects.json`, щоб не показувати одне й те саме.


1. Вимоги
---------

1) Встановлений Node.js (рекомендовано v18+).
2) У корені проєкту мають бути:
   - `index.cjs`
   - `package.json` з залежністю `openai` та `dotenv`
   - `.env` з ключами
   - (автоматично створюються) `seen-projects.json` та файли `results-*.json`.
3) Робочий інтернет (для запитів до Freelancehunt та OpenAI).


2. Налаштування через .env
--------------------------

Обовʼязкові змінні:

- `FREELANCEHUNT_TOKEN` або `FH_TOKEN`
  - персональний токен API з Freelancehunt.

- `OPENAI_API_KEY`
  - API ключ OpenAI.

Опціональні:

- `OPENAI_MODEL`
  - модель для Етапу 1 (оцінка релевантності).
  - дефолт у коді: `gpt-4o-mini`.
  - можеш поставити, наприклад: `gpt-4.1-mini` або іншу, яка тобі вигідна по ціні/швидкості.

- `MAX_PROJECTS_TO_LOAD`
  - скільки максимум проєктів тягнути за один запуск.
  - дефолт: `400`.

- `MIN_BUDGET_UAH`
  - мінімальний бюджет (у гривнях), нижче якого проєкти за замовчуванням відсікаються
    (якщо бюджету немає взагалі — такий проєкт все одно може пройти, якщо релевантний).
  - дефолт: `1000`.

- `BATCH_SIZE`
  - скільки проєктів віддається в одну партію моделі OpenAI.
  - дефолт: `8`.

Приклад `.env`:

    FREELANCEHUNT_TOKEN=xxxxxxxxxxxxxxxxxxxxxxxx
    OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxx

    OPENAI_MODEL=gpt-4o-mini
    MAX_PROJECTS_TO_LOAD=400
    MIN_BUDGET_UAH=1500
    BATCH_SIZE=8


3. Запуск скрипта
-----------------

Базові команди:

1) Звичайний запуск (аналізує тільки нові проєкти, яких ще немає у seen-projects.json):

    node index.cjs

2) Повний запуск (ігнорує seen-projects.json, аналізує всі актуальні проєкти з API):

    node index.cjs --full


4. Логіка роботи крок за кроком
-------------------------------

1) Перевірка .env:
   - якщо немає FREELANCEHUNT_TOKEN / FH_TOKEN → скрипт завершується з помилкою;
   - якщо немає OPENAI_API_KEY → теж помилка.

2) Завантаження `seen-projects.json`:
   - якщо файл існує:
     - читаємо масив id, перетворюємо в Set;
   - якщо файлу немає:
     - створюється порожній Set;
   - це історія вже проаналізованих проєктів.

3) Завантаження проєктів з Freelancehunt:

   GET-запити:

   - `https://api.freelancehunt.com/v2/projects?page[number]=N&page[size]=50`
   - заголовки:
     - `Authorization: Bearer <FH_TOKEN>`
     - `Accept: application/json`

   Скрипт:
   - проходить по сторінках, поки:
     - не набрано `MAX_PROJECTS_TO_LOAD` проєктів,
     - або немає `links.next` (кінець пагінації).
   - для кожного проекту бере:
     - `id`
     - `attributes.name / title` → `title`
     - `attributes.description` → `description`
     - `attributes.budget` → нормалізується в структуру `{ amount, currency, raw, uah }`
       через функцію `normalizeBudget(...)`
     - `attributes.status` → визначення `status` + `isAcceptingBids`
     - `links.self_web` або запасний URL → `url`
     - `published_at / created_at` → `createdAt`

   Бюджет конвертується в UAH:

   - `UAH` / `ГРН` → як є
   - `USD` / `$` → множимо на 40
   - `EUR` / `€` → множимо на 43
   - `PLN`         → множимо на 10
   - інші валюти → лишаємо amount без змін (може бути неідеально, але не ламає логіку).

4) Локальний префільтр (без AI):

   - Відкидаються проєкти, які:
     - явно не приймають ставки (`закрыт`, `завершен`, `closed`, `finished` тощо).
   - Відсікаються задачі з "сміттєвими" ключами (копірайт, чистий дизайн, переклади, відеомонтаж),
     **якщо** при цьому немає згадок про:
     - google / ads / seo / ga4 / gtm / crm / email / shopping / merchant.
   - Залишаються лише:
     - проєкти з хоча б одним ключем із списку HIGH_PRIORITY_KEYWORDS
       (Google Ads, GA4, GTM, Merchant, Shopping, PMax, SEO, CRM, email, B2B, e-commerce, і т.п.),
     - або "чистий" контент по картках товарів (щоб не втратити низькопріоритетні, але потенційно корисні задачі).
   - Бюджетний фільтр:
     - або budget.uah == null (немає бюджету),
     - або budget.uah >= MIN_BUDGET_UAH.

   На цьому етапі ти відсікаєш масу нерелевантного шуму ще до OpenAI.

5) Врахування seen-projects:

   - Якщо режим `NORMAL` (без `--full`):
     - з префільтрованого списку відкидаються всі, чий id вже є в `seen-projects.json`.
   - Якщо режим `FULL`:
     - до моделі йдуть всі префільтровані проєкти;
     - `seen` не використовується для фільтрації, але все одно оновлюється після аналізу.

6) Взаємодія з OpenAI:

   - Префільтровані (і, за потреби, відфільтровані по seen) проєкти діляться на батчі розміром `BATCH_SIZE`.
   - Для кожної партії формується prompt:
     - `system`:
       - описує, що ти технічний маркетолог (Google Ads, Merchant/Shopping, GA4/GTM, SEO, CRM, email, B2B),
       - Merchant/Shopping/PMax — топ-пріоритет,
       - менеджерські ролі не відкидати, але давати їм нижчий пріоритет.
     - `user`:
       - список проєктів у форматі:

         #id=123
         Назва: ...
         Бюджет: ...
         Опис: ...
         ---

       - чітка інструкція повернути **чистий JSON-масив** з обʼєктами:

         [
           {
             "id": "123",
             "fit": true,
             "score": 9,
             "category": "core_paid",
             "reason": "..."
           },
           ...
         ]

     - Категорії:
       - `core_paid`       — ключові задачі з нормальним бюджетом (Google Ads, Merchant/Shopping, GA4/GTM, SEO e-commerce, CRM, email, B2B).
       - `core_noprice`    — те саме, але без чіткого бюджету.
       - `site_full`       — створення/оптимізація сайту / магазину під ключ (особливо під SEO і швидкість).
       - `managerial`      — вакансії: Lead Generation Manager, Marketing Manager тощо.
       - `low_priority_cards` — наповнення/редагування карток товарів.
       - `other`           — усе, що не про маркетинг/аналітику.

     - `score`: 1..10
       - 9–10 — топові задачі по твоєму профілю.

7) Ручне підсилення/заниження (post-processing):

   - Якщо в тайтлі/описі/`reason` є:
     - `merchant center`, `google shopping`, `shopping`, `performance max`, `pmax`, `фід`, `feed`:
       - піднімається score до мінімум 9 (але не більше 10),
       - `isMerchant = true`.
   - Якщо в назві менеджерська роль:
     - `manager`, `менеджер`, `lead generation manager`, `marketing manager`:
       - `category = "managerial"`,
       - score трохи знижується, але не нижче 5,
       - `isManagerial = true`.
   - Якщо це явний сайт/лендінг/інтернет-магазин "під ключ":
       - category може змінюватись на `"site_full"`.
   - Якщо це контент по картках:
       - category → `"low_priority_cards"`.

8) Формування фінального об’єкта для кожного проєкту:

   Кожен запис у `evaluatedRecords` виглядає так:

   - `id`          — id проєкту на Freelancehunt (рядок)
   - `title`       — назва
   - `url`         — посилання на проєкт
   - `budgetStr`   — сирий бюджет як рядок (наприклад, "300 USD")
   - `budgetUAH`   — бюджет у гривнях (або null)
   - `fit`         — true/false (чи варто взагалі розглядати)
   - `score`       — оцінка моделі (1..10)
   - `finalScore`  — скоригований score після ручного тюнінгу
   - `category`    — категорія (core_paid/core_noprice/site_full/managerial/low_priority_cards/other)
   - `reason`      — коротке пояснення від моделі
   - `isMerchant`  — чи підсилений як Merchant/Shopping/PMax
   - `isManagerial`— чи віднесений до менеджерської ролі

9) Сортування:

   Сортування по пріоритету:

   1) `fit` — true вище false;
   2) `finalScore` — по спаданню;
   3) наявність бюджету: з бюджетом вище без бюджету;
   4) величина `budgetUAH` — більший вище.

10) Збереження результатів:

   Створюються два файли з ISO-датою в назві:

   - повний список усіх проєктів, які дійшли до моделі:

     `results-YYYY-MM-DDTHH-MM-SSZ.json`

   - окремий список тільки з рекомендованими (fit=true):

     `results-recommended-YYYY-MM-DDTHH-MM-SSZ.json`

   Структура — масив з обʼєктами (див. пункт 8).

11) Оновлення seen-projects:

   - Усі id проєктів, що були відправлені в AI (projectsForAI), додаються в Set `seen`,
   - `seen-projects.json` перезаписується як масив id.
   - Наступний запуск у режимі `NORMAL` ці проєкти вже не буде аналізувати.


5. Консольний вивід
-------------------

Після завершення:

1) Лог по всіх проєктах, які дійшли до AI:

   - id, fit, finalScore, Merchant/Manager-флаг, назва, бюджет, url, reason.

2) Групи:

   - Рекомендовані з бюджетом (основний пріоритет).
   - Рекомендовані без бюджету.
   - Окремо: сайти / розробка під ключ.
   - Низький пріоритет: картки товарів.

3) Наприкінці — імена файлів, куди збережено:

   - повний список (`results-*.json`);
   - рекомендовані (`results-recommended-*.json`).


6. Типовий воркфлоу для Етапу 1
-------------------------------

1) Оновити `.env`:
   - поставити актуальний `FREELANCEHUNT_TOKEN` / `FH_TOKEN`;
   - `OPENAI_API_KEY`;
   - за потреби відкоригувати:
     - `OPENAI_MODEL`,
     - `MAX_PROJECTS_TO_LOAD`,
     - `MIN_BUDGET_UAH`,
     - `BATCH_SIZE`.

2) Запустити:

   - стандартно:

       node index.cjs

   - або, якщо хочеш заново передивитись усе (наприклад, змінила логіку фільтрації):

       node index.cjs --full

3) Подивитись консоль:
   - які проєкти в топі,
   - що модель пише в `reason`.

4) Відкрити файл:

   - `results-recommended-*.json` — це ти будеш використовувати для другого етапу
     (`prepare-responses.cjs`), де готуються чернетки відповідей і розрахунок годин/вартості.

--------------------------------
Кінець документа `index-usage.txt`
--------------------------------
